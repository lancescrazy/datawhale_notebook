# 概述推荐系统全貌

## 一、推荐算法的理解

推荐系统：更有效的连接用户和内容和服务

主要由数据、算法、架构组成

> 数据提供了信息：数据存储用户与商品的属性，其数据特征决定了一个算法的上限
>
> 算法提供了逻辑：对于大量的数据和高纬度，算法提供一套复杂的信息处理`逻辑
>
> 架构解放了双手：架构保证推荐自动化、实时性的运行：包括了：接受用户请求，收集、处理，存储用户数据，推荐算法计算，返回推荐结果

## 二、推荐系统的整体框架

> 协议调度：请求的发送和结果的回传。请求中，用户发送自己的id，地理位置信息。回传会返回推荐系统给用户的推荐
>
> 推荐算法：算法按照一定的逻辑产生推荐结果
>
> 消息队列：数据的上报与处理。根据用户的ID，拉去例如用户的性别，之前的点击，收藏等用户信息；新行为会存储在存储单元中
>
> 存储单元：不同数据类型和用途存储在不同的存储单元。内容标签、索引--mysql，实时数据--redis，需要数据统计数据--TDW

## 三、用户画像

### 3.1  用户标签

对多维事物的降维理解，抽象出更有代表特点，使用标签来构建立体的花香

### 3.2 用户画像的分类

原始数据 -- 数据清洗 -- > 事实标签 -- 建模分析 -- > 模型分析

### 1. 原始数据

> - 用户数据： 性别，年龄，渠道，注册时间，手机机型
> - 内容数据：游戏的品类，游戏描述，评论爬虫得到的关键词与标签
> - 用户与内容的交互：基于用户的行为，用户对游戏品类的，关键词，标签的喜好
> - 外部数据：单一的产品只能描述用户的某一类喜好，外部数据标签帮助用户更立体

### 2. 事实标签

> - 静态画像：用户独立于产品场景之外的属性，如自然属性，较稳定，有统计意义
> - 动态画像：用户在场景中产生的显示行为或隐式行为
> - 显示行为：用户明确的表达了自己的喜好：点赞、分享、关注、评分。（评论的处理更复杂）
> - 隐式行为：没有明确表达喜好：实际行动如，点击，停留时长等隐性行为表达喜好

隐式行为权重小，但数据量大，显示行为稀疏

### 3. 模型标签

事实标签通过加权或者聚类分析获得，通过一层的加工处理得到，标签所包含的信息量提升

> 聚类分析：按照用户的活跃度进行聚类：高，中，低
>
> 加权计算：根据行为，对用户标签加权计算，得到每个标签的分数，用于推荐算法的计算

## 四、内容画像

内容画像：

> 文章推荐：NLP对关键词，标签的提取
>
> 视频推荐：图片处理
>
> 对推荐的商品或内容进行处理

环境变量：

> 环境画像：浏览内容所处的时间、地点、浏览的前后内容、当天已浏览时间

>  ----- 分类 -----
>
> 视频推荐
>
> 电商推荐
>
> 文章推荐
>
> 社交网络推荐
>
> 广告推荐
>
> 游戏推荐

## 五、算法构建

### 5.1 推荐算法流程

推荐算法步骤：

> 1. 召回：用户、内容量比较大时，先通过召回策略，将百万量级内容先缩小到百量集
> 2. 过滤：针对内容不可重复消费领域：强实时性新闻，对曝光过的用户和点击后过滤
> 3. 精排：召回过滤后排序，百量级推送
> 4. 混排：对精排结果修改，控制某一类型的频次
> 5. 强规则：根据业务规则修改，置顶文章

> 抖音  vs  快手
>
> 抖音：内容质量分发：内容质量 > 关系 > 双向互动
>
> 快手：社交兴趣分发：内容质量 = 关系 > 双向互动
>
> 抖音：90天  +  精品召回池

### 5.2 召回策略

> 召回的目的：针对大量级的用户与内容 --> 降低算法时间复杂度
>
> 召回的重要性：一定优的召回模型是精排模型的基础
>
> 召回的方法：不该是策略堆砌，而是方法补充
>
> - 热销召回：热门内容召回
> - 协同召回：基于用户与用户行为的相似性推荐，突破限制，发现用户的潜在兴趣偏好
> - 标签召回：根据用户行为，构建标签，根据标签召回内容
> - 时间召回：将一段时间内最新的内容召回

### 5.3 精排策略

#### 5.3.1 精排模型

基本原理

| 精排模型                 | 基本原理                                               |                                                         |
| ------------------------ | ------------------------------------------------------ | ------------------------------------------------------- |
| 基于内容属性的相似性推荐 | 根据内容相似性                                         |                                                         |
| 基于用户行为的协同过滤   | 基于用户的协同过滤                                     | 根据用户过去行为判断用户间相似性                        |
|                          | 基于内容的协同过滤                                     | 根据用户过去行为判断内容间相似性                        |
| 分类模型                 | 逻辑回归                                               | 将点击率作为Y变量，预测用户对每一个内容 0 - 1间的点击率 |
|                          | FM                                                     |                                                         |
|                          | 树模型                                                 |                                                         |
|                          | 深度学习DNN                                            |                                                         |
| 因子分解                 | 将评分矩阵分解为用户与内容矩阵，根据相似性预测其他评分 |                                                         |



#### 5.3.2 Model-based 精排模型--逻辑回归为例

**原理：**

1. 概念：逻辑回归通过 sigmoid 函数， 将线性回归变为可以解决二分类的方法，用于估计事物发生可能性
2. 计算公式** : **Y 根据目标设计：是否点击；X 根据特征工程设计：涉及用户画像，内容画像，即对样本的特征的刻画。特征工程根据业务场景选择合适特征并加工。W 由模型训练得到

**构建流程：**

基于目标，进行样本收集，对已收集样本进行特征改造，进行训练，得到模型参数

**建立样本：**

逻辑回归：有监督模型

正样本：用户曝光过物品并点击

负样本：用户曝光过物品不点击

**特征工程：**

对样本深度特征刻画，深入观察访谈，了解对推荐内容的反馈 --> 新的特征开发方向

- 基础数据
- 趋势数据
- 时间数据
- 交叉数据

参数少 -- 内积 -- 聚合 -- 分素乘积 -- 离散 -- 笛卡尔积 -- > 参数多

reference：concept to Code: Deep Learning for Multitask Recommendation

## 六、算法衡量标准

### 6.1 算法衡量指标

> 硬指标：点击率 （会导致标题党上位
>
> 软指标：帮助挖掘埋没的优质内容，推荐给感兴趣的用户
>
> 推荐准确度、推荐覆盖度、用户满意度

### 6.2 获得推荐效果

> 离线实验：滚动时间窗口
>
> 用户反馈：小范围白板测试
>
> 在线测试（AB test）

## 七、算法之外

**推荐算法是否导致信息不平等和信息茧房**

> 呢哦荣不平等或更多产生于用户天性本身
>
> 人们更集中于垂直喜好

目标：追求长期价值，带用户探索世界

**如何帮助用户挖掘小众兴趣**

扩大系统资源池

鼓励主动的行为表达，避免因时间遗忘小众

混排加入随机内容

**算法如何更好与产品结合**

关注产品体验

关注隐形反向指标



